/* ----------------------------------------------------------------------- */
/*                                                                         */
/*   Quartz Arc                                                            */
/*                                                                         */
/*   STM32 F411RE Nucleo 64                                                */
/*                                                                         */
/*   System: Drivers                                                       */
/*   Role: ADC Driver                                                      */
/*   Filename: QAD_ADC.hpp                                                 */
/*   Date: 16th November 2021                                              */
/*   Created By: Benjamin Rosser                                           */
/*                                                                         */
/*   This code is covered by Creative Commons CC-BY-NC-SA license          */
/*   (C) Copyright 2021 Benjamin Rosser                                    */
/*                                                                         */
/* ----------------------------------------------------------------------- */

//Prevent Recursive Inclusion
#ifndef __QAD_ADC_HPP_
#define __QAD_ADC_HPP_

//Includes
#include "setup.hpp"

#include "QAD_TimerMgr.hpp"


	//------------------------------------------
	//------------------------------------------
	//------------------------------------------


//QAD_ADC_Channel
enum QAD_ADC_Channel : uint8_t {
	QAD_ADC_Channel1 = 0,
	QAD_ADC_Channel2,
	QAD_ADC_Channel3,
	QAD_ADC_Channel4,
	QAD_ADC_Channel5,
	QAD_ADC_Channel6,
	QAD_ADC_Channel7,
	QAD_ADC_Channel8,
	QAD_ADC_Channel9,
	QAD_ADC_Channel10,
	QAD_ADC_Channel11,
	QAD_ADC_Channel12,
	QAD_ADC_Channel13,
	QAD_ADC_Channel14,
	QAD_ADC_Channel15,
	QAD_ADC_Channel16
};


//QAD_ADC_MAXCHANNELS
#define QAD_ADC_MAXCHANNELS    16


	//------------------------------------------
	//------------------------------------------
	//------------------------------------------


//QAD_ADC_PeriphChannel
enum QAD_ADC_PeriphChannel : uint32_t {
	QAD_ADC_PeriphChannel0       = ADC_CHANNEL_0,
	QAD_ADC_PeriphChannel1       = ADC_CHANNEL_1,
	QAD_ADC_PeriphChannel2       = ADC_CHANNEL_2,
	QAD_ADC_PeriphChannel3       = ADC_CHANNEL_3,
	QAD_ADC_PeriphChannel4       = ADC_CHANNEL_4,
	QAD_ADC_PeriphChannel5       = ADC_CHANNEL_5,
	QAD_ADC_PeriphChannel6       = ADC_CHANNEL_6,
	QAD_ADC_PeriphChannel7       = ADC_CHANNEL_7,
	QAD_ADC_PeriphChannel8       = ADC_CHANNEL_8,
	QAD_ADC_PeriphChannel9       = ADC_CHANNEL_9,
	QAD_ADC_PeriphChannel10      = ADC_CHANNEL_10,
	QAD_ADC_PeriphChannel11      = ADC_CHANNEL_11,
	QAD_ADC_PeriphChannel12      = ADC_CHANNEL_12,
	QAD_ADC_PeriphChannel13      = ADC_CHANNEL_13,
	QAD_ADC_PeriphChannel14      = ADC_CHANNEL_14,
	QAD_ADC_PeriphChannel15      = ADC_CHANNEL_15,
	QAD_ADC_PeriphChannel16      = ADC_CHANNEL_16,
	QAD_ADC_PeriphChannel17      = ADC_CHANNEL_17,
	QAD_ADC_PeriphChannel18      = ADC_CHANNEL_18,
	QAD_ADC_PeriphChannelVRefInt = ADC_CHANNEL_VREFINT,
	QAD_ADC_PeriphChannelVBat    = ADC_CHANNEL_VBAT
};


//QAD_ADC_SamplingTime
enum QAD_ADC_SamplingTime : uint32_t {
	QAD_ADC_PeriphSamplingTime_3Cycles   = ADC_SAMPLETIME_3CYCLES,
	QAD_ADC_PeriphSamplingTime_15Cycles  = ADC_SAMPLETIME_15CYCLES,
	QAD_ADC_PeriphSamplingTime_28Cycles  = ADC_SAMPLETIME_28CYCLES,
	QAD_ADC_PeriphSamplingTime_56Cycles  = ADC_SAMPLETIME_56CYCLES,
	QAD_ADC_PeriphSamplingTime_84Cycles  = ADC_SAMPLETIME_84CYCLES,
	QAD_ADC_PeriphSamplingTime_112Cycles = ADC_SAMPLETIME_112CYCLES,
	QAD_ADC_PeriphSamplingTime_144Cycles = ADC_SAMPLETIME_144CYCLES,
	QAD_ADC_PeriphSamplingTime_480Cycles = ADC_SAMPLETIME_480CYCLES
};


	//------------------------------------------
	//------------------------------------------
	//------------------------------------------

//------------------
//QAD_ADC_InitStruct
typedef struct {

	QAD_Timer_Periph  eTimer;
	uint32_t          uTimer_Prescaler;
	uint32_t          uTimer_Period;

} QAD_ADC_InitStruct;



	//------------------------------------------
	//------------------------------------------
	//------------------------------------------

//---------------
//QAD_ADC_Channel
typedef struct QAD_ADC_ChannelData {

	GPIO_TypeDef*    pGPIO;
	uint16_t         uPin;

	QAD_ADC_PeriphChannel eChannel;
	QAD_ADC_SamplingTime  eSamplingTime;


	//---------
	//Operators

	//Assignment operator
	QAD_ADC_ChannelData& operator=(const QAD_ADC_ChannelData& other) {
		pGPIO         = other.pGPIO;
		uPin          = other.uPin;
		eChannel      = other.eChannel;
		eSamplingTime = other.eSamplingTime;
		return *this;
	}

} QAD_ADC_ChannelData;


	//------------------------------------------
	//------------------------------------------
	//------------------------------------------


//-------
//QAD_ADC
class QAD_ADC {
private:
	enum DeinitMode : uint8_t {DeinitPartial = 0, DeinitFull};

	QA_InitState            m_eInitState;
	QA_ActiveState          m_eState;

	QAD_Timer_Periph        m_eTimer;
	uint32_t                m_uTimer_Prescaler;
	uint32_t                m_uTimer_Period;

	TIM_HandleTypeDef       m_sTIMHandle;
	ADC_HandleTypeDef       m_sADCHandle;

	QAD_ADC_ChannelData     m_sChannels[QAD_ADC_MAXCHANNELS];
	uint8_t                 m_uChannelCount;

	uint16_t                m_uData[QAD_ADC_MAXCHANNELS];
	uint8_t                 m_uDataIdx;

};


//Prevent Recursive Inclusion
#endif /* __QAD_ADC_HPP_ */
